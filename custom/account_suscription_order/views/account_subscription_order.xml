<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- vistas list General -->
        <record id="account_suscription_order_view_tree" model="ir.ui.view">
            <field name="name">account.suscription.order.tree</field>
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <tree string="Suscription Order">
                    <field name="priority" widget="priority" class="me-3" />
                    <field name="short_name" />
                    <field name="name" />
                    <field name="date_due" />
                    <field name='origin' />
                    <field name="activity_ids" widget="list_activity" optional="show" />
                    <field name='user_id' widget='many2one_avatar_user' />
                    <field name='price_total' widget='monetary' />
                    <field name='qty_pending' widget='monetary' />
                    <field name='stage_id' />
                    <field name="state" />
                </tree>
            </field>
        </record>
        <!-- formulario -->

        <record id="account_suscription_order_view_form" model="ir.ui.view">
            <field name="name">account.suscription.order.form</field>
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <form string="Subscription Order">
                    <header>
                        <button name="confirm_reminder_mail" string="Confirm Receipt Date"
                            type="object"
                            attrs="{'invisible': ['|','|', ('state', 'not in', ('approved', 'suscribed')), ('mail_reminder_confirmed', '=', True), ('date_planned', '=', False)]}"
                            data-hotkey="o" />
                        <field name='stage_id' widget="statusbar"
                            options="{'clickable': '1', 'fold_field': 'fold' " />
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <span class="o_form_label"
                                attrs="{'invisible': [('state','in',('draft'))]}">Subscription
                                Order </span>
                            <h1 class="d-flex mb32">
                                <field name="short_name" readonly="1" />
                                <field name="priority" widget="priority" class="me-3" />
                            </h1>
                        </div>
                        <newline />
                        <group id='header_left_group' string='Info'>
                            <field name='name' />
                            <field name="state" />
                            <field name='origin' />
                            <field name='active' string='Active' />
                            <field name='company_id' string="Company" />
                            <field name='currency_id' string="Currency" />
                            <field name="activity_ids" widget="list_activity" optional="show" />
                        </group>
                        <group>
                            <field name='date_due' />
                            <field name="date_order" />
                            <label for="date_approve"
                                attrs="{'invisible': [('state','in',('draft','new'))]}" />
                            <div name="date_approve"
                                attrs="{'invisible': [('state','in',('draft','new'))]}"
                                class="o_row">
                                <field name="date_approve" />
                                <field name="mail_reception_confirmed" invisible="1" />
                                <span class="text-muted"
                                    attrs="{'invisible': [('mail_reception_confirmed','=', False)]}">(confirmed
                                    by vendor)</span>
                            </div>
                            <label for="date_planned" />
                            <div name="date_planned_div" class="o_row">
                                <field name="date_planned"
                                    attrs="{'readonly': [('state', 'not in', ('draft','new'))]}" />
                                <field name="mail_reminder_confirmed" invisible="1" />
                                <span class="text-muted"
                                    attrs="{'invisible': [('mail_reminder_confirmed', '=', False)]}">(confirmed
                                    by vendor)</span> 
                            </div>
                            <label for="receipt_reminder_email" class="d-none"
                                 />
                            <div name="reminder" class="o_row"
                                title="Automatically send a confirmation email to the vendor X days before the expected receipt date, asking him to confirm the exact date.">
                                <field name="receipt_reminder_email" />
                                <span>Ask confirmation</span>
                                <div class="o_row oe_inline"
                                    attrs="{'invisible': [('receipt_reminder_email', '=', False)]}">
                                    <field name="reminder_date_before_receipt" /> day(s) before <widget
                                        name='toaster_button' button_name="send_reminder_preview"
                                        title="Preview the reminder email by sending it to yourself."
                                        attrs="{'invisible': [('id', '=', False)]}" />
                                </div>
                            </div>
                        </group>
                        <group string='Shares Info' id='header_right_group'>
                            <field name='share_qty' />
                            <field name='nominal_value' />
                            <field name='price' widget='monetary' />
                            <field name='price_total' widget='monetary' />
                        </group>
                        <group string='Company Info'>
                            <field name='company_id' />
                            <field name='payment_term_id' />
                            <span class="oe_inline o_form_label mx-3"> in </span>
                            <field name="currency_id"
                                attrs="{'readonly': [('state', '!=', 'draft')]}" />
                            <field name='partner_id' widget="many2one_avatar" />
                            <field name='user_id' widget="many2one_avatar" />
                        </group>
                        <newline />
                        <notebook>
                            <page id='cash_lines' string='Cash Lines'>
                                <group string='Order Lines'>
                                    <field name='order_line_ids' widget="section_and_note_one2many" context="{'default_state': 'draft', 'tree_view_ref' : 'account_suscription_order.account_suscription_order_line_cash_view_tree'}" attrs="{'readonly': [('state', 'in', ('new','approved', 'subscribed','finished','canceled'))]}"
                                         />
                                </group>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="credit_total" widget="account-tax-totals-field"
                                        nolabel="1" colspan="2" readonly="1" />
                                </group>
                            </page>
                            <page id='credit_lines' string='Credit Lines'>
                                <group string='Order Lines'>
                                    <field name='order_line_ids' widget="section_and_note_one2many"
                                        context="{'default_state': 'draft', 'tree_view_ref' : 'account_suscription_order.account_suscription_order_line_credit_view_tree'}" attrs="{'readonly': [('state', 'in', ('new','approved', 'subscribed','finished','canceled'))]}" domain="[('line_type','=','credit')]" />
                                </group>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="credit_total" widget="account-tax-totals-field"
                                        nolabel="1" colspan="2" readonly="1" />
                                </group>
                            </page>
                            <page id='product_lines' string='Product Lines'>
                                <group string='Order Lines'>
                                    <field name='order_line_ids' widget="section_and_note_one2many"
                                       context="{'default_state': 'draft', 'tree_view_ref' : 'account_suscription_order.account_suscription_order_line_product_view_tree'}" attrs="{'readonly': [('state', 'in', ('new','approved','subscribed','finished','canceled'))]}" domain="[('line_type','=','product')]" />
                                </group>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="product_total" widget="account-tax-totals-field"
                                        nolabel="1" colspan="2" readonly="1" />
                                </group>
                            </page>
                        </notebook>
                        <group>
                            <group>
                                <field colspan="2" name="notes" nolabel="1"
                                    placeholder="Define your terms and conditions..." />
                            </group>
                            <group class="oe_subtotal_footer oe_right">
                                <field name="amount_total" widget="account-tax-totals-field"
                                    nolabel="1" colspan="2" readonly="1" />
                            </group>
                        </group>
                        <div class="clearfix" />
                    </sheet>
                    <div class="o_attachment_preview"
                        options="{types: ['image', 'pdf'], 'order':'desc'}"
                        attrs="{'invisible': [('state', '!=', 'draft')]}" />
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="activity_ids" />
                        <field name="message_ids" />
                    </div>
                </form>
            </field>
        </record>
        <!-- Search view -->
        <record id="account_suscription_order_view_search" model="ir.ui.view">
            <field name="name">account.suscription.order.search</field>
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <search string="Suscription Order Search">
                    <field name="name" string="Reference"
                        filter_domain="[
                    '|', '|',
                        ('name', 'ilike', self),
                        ('short_name', '=', self),
                        ('description', 'ilike', self)]" />
                    <separator />
                    <field name="state" />
                    <field name="notes" string="Notes" />
                    <field name="partner_id" string="Partner" />
                    <field name="company_id" string="Company" />
                    <field name='origin' string='Origin Doc' />
                    <field name='currency_id' string='Currency' />
                    <field name='user_id' string='User' />
                    <separator />
                    <filter name="my_purchases" string="My Purchases"
                        domain="[('user_id', '=', user_id)]" />
                    <filter string="Starred" name="starred" domain="[('priority', '=', '1')]" />
                    <separator />
                    <filter name="draft" string="RFQs"
                        domain="[('state', 'in', ('draft', 'new'))]" />
                    <separator />
                    <filter name="approved" string="Suscription  Orders"
                        domain="[('state', 'in', ('approved', 'subscribed'))]" />
                    <filter name="to_approve" string="To Approve"
                        domain="[('state', '=', 'new')]" />
                    <filter name="draft_rfqs" string="Draft RFQs"
                        domain="[('state', '=', 'draft')]" />
                    <filter name="late_rfqs" string="Late RFQs"
                        domain="[('state', 'in', ['draft', 'new']),('date_planned', '&lt;', datetime.datetime.now())]" />
                    <separator />
                    <filter string="Late Activities" name="activities_overdue"
                        domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                        help="Show all records which has next action date is before today" />
                    <filter string="Today Activities" name="activities_today"
                        domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]" />
                    <filter string="Future Activities" name="activities_upcoming_all"
                        domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]" />
                    <separator />
                    <filter string="Active" name="active" context="{'group_by':'active'}" />
                    <filter string="Company" name="company_id" context="{'group_by':'company_id'}" />
                    <filter string="Partner" name="partner_id"
                        context="{'group_by':'partner_id'}" />
                    <filter string="Currency" name="currency_id"
                        context="{'group_by':'currency_id'}" />

                    <filter string="User" name="user_id"
                        context="{'group_by':'user_id'}" />
                    <group expand="1" string="Group By">
                        <filter string="Company" name="company_id"
                            context="{'group_by':'company_id'}" />
                        <filter string="Partner" name="partner_id"
                            context="{'group_by':'partner_id'}" />
                        <filter string="Currency" name="currency_id"
                            context="{'group_by':'currency_id'}" />
                        <filter string="User" name="user_id" context="{'group_by':'user_id'}" />
                        <filter string="Stage" name="state" context="{'group_by':'state'}" />
                        <filter name="active"
                            string="Active" domain="[('active','=',True)]" />
                    </group>
                    <!-- Panel lateral de busqueda -->
                    <searchpanel>
                        <field name='user_id' icon='fa fa-users' />
                        <field name='partner_id' icon='fa fa-list' select="multi" groupby='position' />
                        <field name='currency_id' icon='fa fa-solid fa-wallet' select="multi" />
                        <field name='stage_id' icon='fa-solid fa-mug-saucer' select="multi" groupby='order_state' />
                        <field name='payment_term_id' icon='fa-solid fa-magnifying-glass-chart'
                            select="multi" groupby='name' />
                    </searchpanel>
                </search>
            </field>
        </record>
        <!-- Estate Property Kanban View  -->
        <record model="ir.ui.view" id="view_account_suscription_order_kanban">
            <field name="name">account.suscription.order.kanban</field>
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <!-- class="o_kanban_mobile" js_class="property_kanban_dashboard" sample="1" -->
                <kanban default_group_by="stage_id" group_create='1' group_delete='1'
                    group_edit='1'
                    archivable='1' quick_create='1'
                    quick_create_view='account_suscription_order.account_suscription_order_form_quick_create'
                    on_create='0'>
                    <field name="short_name" />
                    <field name="name" />
                    <field name="origin" readonly="1" />
                    <field name="description" />
                    <field name="stage_id" />
                    <field name="state" />
                    <field name="priority" widget="priority" />
                    <field name="date_order" />
                    <field name="date_approve" />
                    <field name="date_due" />
                    <field name="date_planned" />
                    <field name="nominal_value" />
                    <field name="price_total" />
                    <field name="company_id" />
                    <field name="partner_id" />
                    <field name="payment_term_id" />
                    <field name="currency_id" />
                    <field name="qty_pending" />
                    <field name="user_id" widget="many2one_avatar_user" />
                    <progressbar field="stage_id"
                        colors='{"integrated": "success", "today": "warning", "approved": "danger"}' />
                    <templates>
                        <t t-name="kanban-box">
                            <div
                                t-attf-class="d-flex flex-column p-0 oe_kanban_card oe_kanban_global_click">
                                <div
                                    class="o_kanban_content p-0 m-0 position-relative row d-flex flex-fill">
                                    <div
                                        class="col-3 text-bg-primary p-2 text-center d-flex flex-column justify-content-center">

                                        <div
                                            t-esc="luxon.DateTime.fromISO(record.date_order.raw_value).toFormat('d')"
                                            class="o_event_fontsize_20" />
                                        <div>
                                            <t
                                                t-esc="luxon.DateTime.fromISO(record.date_planned.raw_value).toFormat('MMM yyyy')" />
                                        </div>
                                        <div>
                                            <t
                                                t-esc="luxon.DateTime.fromISO(record.date_due.raw_value).toFormat('t')" />
                                        </div>

                                    </div>
                                    <div class="row mb4">
                                        <em class="col-10">
                                            <field name="name" />
                                        </em>
                                        <div class="col-2 text-end">
                                            <img
                                                t-att-src="kanban_image('res.partner', 'avatar_128', record.partner_id.raw_value)"
                                                t-att-title="record.partner_id.value"
                                                t-att-alt="record.partner_id.value"
                                                class="oe_kanban_avatar o_image_24_cover" />
                                        </div>
                                    </div>
                                    <div
                                        class="company_info col-2 d-flex flex-column justify-content-evenly py-1"
                                        style="min-height: 60px;"
                                        t-if="record.company_id.value">
                                        <em class="col-10">
                                            <field name="priority" widget='priority' />
                                        </em>
                                        <div class="text-end">
                                            <img
                                                t-att-src="kanban_image('res.company', 'avatar_128', record.company_id.raw_value)"
                                                t-att-title="record.company_id.value"
                                                t-att-alt="record.company_id.value"
                                                class="oe_kanban_avatar o_image_24_cover" />
                                        </div>
                                        <div class="company_box">
                                            <span t-esc='record.company_id.street.value'></span>
                                            <i class="fa fa-map-marker mt-1 me-1"
                                                title="Location" />
                                        </div>
                                    </div>
                                    <div
                                        class="o_kanban_record_top mb16 col-7 py-2 px-3 d-flex flex-column justify-content-between pt-3">
                                        <div class="o_kanban_record_headings ml-1">
                                            <div>
                                                <div t-if="record.company_id.value" class="d-flex">
                                                    <i class="fa fa-map-marker mt-1 me-1"
                                                        title="Location" />
                                                    <span t-esc="record.company_id.value" />
                                                </div>
                                            </div>
                                            <strong class="o_kanban_record_title">
                                                <h5 class="o_event_fontsize_11 p-0">
                                                    <div t-if="record.short_name.value">
                                                        <div class="pt-2 pt-md-0">
                                                            <i class="fa fa-level-up fa-rotate-90"
                                                                title="Confirmed" />
                                                            <span>
                                                                <t t-esc="record.short_name.value" />
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div t-if='t-if="record.name.value"'>
                                                        <div class="pt-2 pt-md-0">
                                                            <i class="fa-solid fa-code"></i>
                                                            <span>
                                                                <t t-esc="record.short_name.value" />
                                                            </span>
                                                        </div>
                                                    </div>
                                                </h5>

                                            </strong>
                                            <section class='mx-1'>
                                                <div t-if='t-if="record.description.value"'>
                                                    <div class="pt-2 pt-md-0">
                                                        <em>
                                                            <i class="fa-solid fa-audio-description"></i>
                                                            <span>
                                                                <t t-esc="record.description.value" />
                                                            </span>
                                                        </em>
                                                    </div>
                                                </div>
                                                <field name='qty_pending' widget='monetary' />
                                            </section>
                                        </div>

                                        <strong>
                                            <div t-if="record.share_qty.value">
                                                <span>
                                                    <t t-esc="record.share_qty.value" />
                                                </span>
                                            </div>
                                        </strong>
                                        <hr></hr>
                                        <strong>
                                            <div t-if="record.price_total.value">
                                                <span>
                                                    <t t-esc="record.price_total.value" />
                                                </span>
                                            </div>
                                        </strong>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <p class='p-3'>
                                                <span
                                                    class='font-weight-bolder text-white-50 alert alert-success'>
                                                    <t t-esc="record.short_name.value" />
                                                </span>
                                            </p>
                                            <br />
                                            <field name="activity_ids" widget="kanban_activity" />
                                            <hr />
                                            <field name="partner_id" widget="many2one_avatar" />
                                        </div>
                                        <div class="oe_kanban_bottom_right">

                                            <newline />
                                            <field name="user_id" widget="many2one_avatar_user" />
                                            <!-- options="{'classes': {'draft': 'default', 'new':
                                                'default', 'finished': 'success', 'canceled': 'warning'}}" -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="account_suscription_order_form_quick_create" model="ir.ui.view">
            <field name="name">account.suscription.order.quick_create</field>
            <field name="model">account.suscription.order</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form string="Subscription Order">
                    <group>
                        <field name="name" placeholder="e.g. Suscription por an Shareholder....." />
                        <label for="date_order" string="Date" />
                        <div class="o_row">
                            <field name="date_order" widget="daterange"
                                options="{'related_date_due': 'date_due'}" />
                            <i class="fa fa-long-arrow-right mx-2" aria-label="Arrow icon"
                                title="Arrow" />
                            <field name="payment_term_id"
                                options="{'related_date_order': 'date_order'}" />
                            <field name="currency_id" widget="badges" />
                            <field name='priority' widget='priority' />
                            <field name="description" placeholder="e.g. Description and Terms....--" />
                            <div class="o_row">
                                <field name='share_qty' />
                                <field name='partner_id' />
                            </div>
                        </div>
                    </group>
                </form>
            </field>
        </record>
        <record id="view_account_suscription_order_calendar" model="ir.ui.view">
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <calendar date_start="date_order" date_stop="date_due" color="stage_id"
                    event_open_popup='1' quick_add='1'>
                    <field name="name" />
                    <field name="short_name" />
                    <field name="user_id" />
                    <field name="currency_id" />
                    <field name="payment_term_id" />
                </calendar>
            </field>
        </record>
        <record id="view_account_suscription_order_graph" model="ir.ui.view">
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <graph type="bar" stacked="1">
                    <field name="name" />
                    <field name="short_name" />
                    <field name="user_id" />
                    <field name="stage_id" />
                    <field name="partner_id" />
                    <field name='date_order' interval='month' />
                </graph>
            </field>
        </record>
        <record id="view_account_suscription_order_pivot" model="ir.ui.view">
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <pivot>
                    <field name="user_id" type="row" />
                    <field name="stage_id" type="col" />
                    <field name="partner_id" type="col" />
                </pivot>
            </field>
        </record>
        <record id="view_account_suscription_order_activity" model="ir.ui.view">
            <field name="name">account.suscription.order.activity</field>
            <field name="model">account.suscription.order</field>
            <field name="arch" type="xml">
                <activity string="Tasks">
                    <templates>
                        <div t-name="activity-box">
                            <div>
                                <field name="name" display="full" />
                                <field name="partner_id"
                                    muted="1" display="full" />
                                <field name="user_id"
                                    muted="1" display="full" />
                            </div>
                        </div>
                    </templates>
                </activity>
            </field>
        </record>
        <!-- Accion para crear la emisíon -->
        <record id="account_suscription_order_action" model="ir.actions.act_window">
            <field name="name">Suscription Order</field>
            <field name="res_model">account.suscription.order</field>
            <field name="view_mode">tree,kanban,form,calendar,graph,pivot,activity</field>
            <field name="view_id" ref="account_suscription_order_view_tree" />
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>
    </data>
</odoo>