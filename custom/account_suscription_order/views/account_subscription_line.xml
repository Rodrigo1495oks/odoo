<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- vistas list General -->
        <record id="account_suscription_order_line_view_tree" model="ir.ui.view">
            <field name="name">account.suscription.order.line.tree</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <tree string="Suscription Line" decoration-success="state=='suscribed'"
                    decoration-bf='state=="partial_integrated"' decoration-muted="state=='canceled'">
                    <field name="display_type" invisible="1" />
                    <field name="name" widget="section_and_note_text" />
                    <field name="date" />
                    <field name="ref" />
                    <field name="line_type" />
                    <field name="currency_id" />
                    <field name="money_type" widget='badge' />
                    <field name="description" />
                    <field name="price_unit" widget='monetary' />
                    <field name="price_total" widget='monetary' />
                    <field name="amount_residual" widget='monetary' />
                    <field name="state" optional="show" widget="badge"
                        decoration-success="state == 'integrated'"
                        decoration-warning="state == 'suscribed'"
                        decoration-muted="state=='canceled'" />
                </tree>
            </field>
        </record>
        <!-- vistas list Cash -->
        <record id="account_suscription_order_line_cash_view_tree" model="ir.ui.view">
            <field name="name">account.suscription.order.line.cash.tree</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <tree string="Suscription Line" decoration-success="state=='suscribed'"
                    decoration-bf='state=="partial_integrated"' decoration-muted="state=='canceled'"
                    editable="bottom">
                    <control>
                        <create name="add_product_control" string="Add a Cash Line" />
                        <create name="add_section_control" string="Add a section"
                            context="{'default_display_type': 'line_section'}" />
                        <create name="add_note_control" string="Add a note"
                            context="{'default_display_type': 'line_note'}" />
                    </control>
                    <field name="name" widget="section_and_note_text" />
                    <field name="display_type" invisible="1" />
                    <field name="line_type"/>
                    <field name="product_type" invisible="1" />
                    <field name="currency_id" optional="show" attrs="{'required': [('display_type', '=', False),('line_type', '=', 'money')],'readonly': [('state', '!=', 'draft')]}" force_save="1"/>
                    <field name="money_type" widget='badge'
                    attrs="{'required': [('display_type', '=', False),('line_type', '=', 'money')], 'readonly': [('state', '!=', 'draft')]}" force_save="1"/>
                    <field name="description" optional="show"
                    attrs="{'required': [('display_type', '=', False),('line_type', '=', 'money')], 'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="price_unit" widget='monetary' />
                    <field name="price_total" widget='monetary' />
                    <field name="amount_residual" widget='monetary' />
                    <field name="state" optional="show" widget="badge"
                        decoration-success="state == 'integrated'"
                        decoration-warning="state == 'suscribed'"
                        decoration-muted="state=='canceled'" />
                </tree>
            </field>
        </record>
        <!-- vistas list Credit -->
        <record id="account_suscription_order_line_credit_view_tree" model="ir.ui.view">
            <field name="name">account.suscription.order.line.credit.tree</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <tree string="Suscription Line Credit" decoration-success="state=='suscribed'"
                    decoration-bf='state=="partial_integrated"' decoration-muted="state=='canceled'"
                    editable="bottom">
                    <control>
                        <create name="add_product_control" string="Add a Credit Line" />
                        <create name="add_section_control" string="Add a section"
                            context="{'default_display_type': 'line_section'}" />
                        <create name="add_note_control" string="Add a note"
                            context="{'default_display_type': 'line_note'}" />
                    </control>
                    
                    <field name="display_type" invisible="1" />
                    <field name="line_type"/>
                    <field name="credit_type"  attrs="{'required': [('display_type', '=', False),('line_type', '=', 'credit')], 'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="currency_id" attrs="{'required': [('display_type', '=', False),('line_type', '=', 'credit')], 'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="name" widget="section_and_note_text" />
                    <field optional="show"
                        name="doc_source" attrs="{'required': [('display_type', '=', False),('line_type', '=', 'credit')], 'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="partner_id" attrs="{'required': [('display_type', '=', False),('line_type', '=', 'credit')], 'readonly': [('state', '!=', 'draft')]}" widget="many2one_avatar" />
                    <field name="price_unit" widget='monetary' />
                    <field name="price_total" widget='monetary' />
                    <field name="amount_residual" widget='monetary' />

                    <field name="state" optional="show" widget="badge"
                        decoration-success="state == 'integrated'"
                        decoration-warning="state == 'suscribed'"
                        decoration-muted="state=='canceled'" />
                </tree>
            </field>
        </record>
        <!-- vistas list Product -->
        <record id="account_suscription_order_line_product_view_tree" model="ir.ui.view">
            <field name="name">account.suscription.order.line.product.tree</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <tree string="Suscription Line Product" decoration-success="state=='suscribed'"
                    decoration-bf='state=="partial_integrated"' decoration-muted="state=='canceled'"
                    editable="bottom">
                    <control>
                        <create name="add_product_control" string="Add a product" />
                        <create name="add_section_control" string="Add a section"
                            context="{'default_display_type': 'line_section'}" />
                        <create name="add_note_control" string="Add a note"
                            context="{'default_display_type': 'line_note'}" />
                    </control>
                    <field name="name" widget="section_and_note_text" />
                    <field name="display_type" invisible="1" />
                    <field name="line_type"/>
                    <field name="product_type" invisible="1" />
                    <field name="date" optional="show"
                        attrs="{'required': [('display_type', '=', False)]}" force_save="1" />
                    <field name="product_uom_category_id" invisible="1" />
                    <field name="currency_id" attrs="{
                        'readonly': [('state', '!=', 'draft')],
                        'required': [('display_type', '=', False)]}"/>
                    <field name="product_id" attrs="{
                        'readonly': [('state', '!=', 'draft')],
                        'required': [('display_type', '=', False)]}" force_save="1" domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]" />

                    <field name="asset_profile_id" />
                    <field name="product_qty" />
                    <field name="qty_received_manual" invisible="1" />
                    <field name="qty_received_method" invisible="1" />
                    <field name="qty_received" string="Received"
                        attrs="{'column_invisible': [('parent.stage_id.state', 'not in', ('subscribed', 'finished'))], 'readonly': [('qty_received_method', '!=', 'manual')]}"
                        optional="show" />

                    <field name="product_uom_id" string="UoM" groups="uom.group_uom"
                        attrs="{'readonly': [('state', 'in', ('partial_integrated', 'integrated', 'canceled'))],'required': [('display_type', '=', False)]}" force_save="1" optional="show" />
                    <field name="product_packaging_qty"
                        attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}"
                        groups="product.group_stock_packaging" optional="show" />
                    <field name="product_packaging_id"
                        attrs="{'invisible': [('product_id', '=', False)]}"
                        context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}"
                        groups="product.group_stock_packaging" optional="show" />
                    <field name="price_unit" widget='monetary' />
                    <field name="price_total" widget='monetary' />
                    <field name="state" optional="show" widget="badge"
                        decoration-success="state == 'integrated'"
                        decoration-warning="state == 'suscribed'"
                        decoration-muted="state=='canceled'" />
                </tree>
            </field>
        </record>
        <!-- formulario -->
        <record id="account_suscription_order_line_view_form" model="ir.ui.view">
            <field name="name">account.suscription.order.line.form</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <form string="Subscription Line">
                    <header>
                        <!-- <button name="action_add_vote" string="Aprobar des." default_focus="1"
                            type="object" groups='top_management.top_management_group_president' />
                        <button name="action_add_minus_vote" string="Desaprobar des."
                            default_focus="1"
                            type="object" groups='top_management.top_management_group_president' /> -->
                    </header>
                    <sheet>
                        <group id='header_left_group' string='Line Info'>
                            <field name="display_type" invisible="1" />
                            <field name='order_id' force_save="1" />
                            <field name='date' />
                            <field name='ref' string='reference' />
                            <field name='active' string='Active' />
                            <field name='line_type' widget='label_selection' />
                            <field name='company_id' string="Line's Company" />
                            <field name='currency_id' string="Line's Currency" />
                        </group>
                        <group string='Money Fields' id='header_right_group'
                            attrs="{'invisible': [('line_type', '!=', 'cash')]}">
                            <field name='description' />
                            <field name='money_type' widget='radio' />
                            <field name='state' widget='badges' />
                        </group>
                        <group string='Credit Fields' id='header_down_right_group'
                            attrs="{'invisible': [('line_type', '!=', 'credit')]}">
                            <field name='doc_source' string='Source Document' />
                            <field name='credit_type' widget='radio' />
                            <field name='partner_id' widget="many2one_avatar" />
                        </group>
                        <group string='Product Fields' id='header_down_left_group'
                            attrs="{'invisible': ['|',('line_type', '!=', 'product'),('display_type', '!=', False)]}">
                            <field name='product_id' string='Product Related'
                                context="{'partner_id': parent.partner_id}"
                                widget="many2one_barcode"
                                domain="[('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]" />
                            <field name='partner_id' widget="many2one_avatar" />
                            <field name='asset_profile_id' widget="many2one_avatar" />
                            <label for="product_qty" />
                            <div class="o_row">
                                <field name="product_qty" />
                                <field name="product_uom_id" groups="uom.group_uom"
                                    attrs="{'required': [('display_type', '=', False)]}" />
                            </div>
                            <field name="qty_received_method" invisible="1" />
                            <field name="qty_received" string="Received Quantity"
                                attrs="{'readonly': [('qty_received_method', '!=', 'manual')]}" />
                                <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" />
                        </group>
                        <br></br>
                        <group name='total_fields' string='Total Fields'>
                            <field name='currency_rate' />
                            <field name='price_unit' />
                            <field name='price_total' widget='monetary' />
                            <field name='amount_residual' widget='monetary' />
                        </group>
                        <notebook colspan="4">
                            <page string="Invoices and Incoming Shipments" name="invoices_incoming_shiptments">
                                <field name="account_move_lines"/>
                            </page>
                        </notebook>
                        <group col="12" class="oe_invoice_lines_tab">
                            <group colspan="8">
                                <field name="narration" placeholder="Terms and Conditions"
                                    colspan="2" nolabel="1" />
                            </group>
                            <!-- Totals (only invoices / receipts) -->
                            <group colspan="4">
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="price_total" widget="account-tax-totals-field"
                                        nolabel="1" colspan="2"
                                        attrs="{'readonly': ['|', ('state', '!=', 'draft'), '&amp;',('quick_edit_mode', '=', False)]}" />
                                    <field name="amount_residual"
                                        class="oe_subtotal_footer_separator"
                                        attrs="{'invisible': [('state', '=', 'draft')]}" />
                                </group>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <!-- Estate Property Kanban View  -->
        <record model="ir.ui.view" id="view_account_suscription_order_line_kanban">
            <field name="name">account.suscription.order.line.kanban</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <!-- class="o_kanban_mobile" js_class="property_kanban_dashboard" sample="1" -->
                <kanban default_group_by="state" group_create='1' group_delete='1' group_edit='1'
                    archivable='1'>
                    <field name="order_id" />
                    <field name="line_type" />
                    <field name="company_id" readonly="1" />
                    <field name="date" />
                    <field name="date_maturity" />
                    <field name="ref" />
                    <field name="state" />
                    <field name="doc_source" />
                    <field name="credit_type" />
                    <field name="user_id" />
                    <field name="partner_id" />
                    <field name="product_id" />
                    <field name="asset_profile_id" />
                    <field name="amount_residual" />

                    <progressbar field="state"
                        colors='{"integrated": "success", "suscribed": "warning", "partial_integrated": "danger"}' />
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="row mb4">
                                    <div class="col-8">
                                        <field name="line_type" />
                                    </div>
                                    <strong t-if="record.date.raw_value" class="col-4 ps-0 text-end">
                                        <i class="fa fa-clock-o" aria-label="Date" role="img"
                                            title="Date" />
                                        <field name="date" />
                                        <i class="fa fa-clock-o" aria-label="Date" role="img"
                                            title="Due Date" />
                                        <field name="date_maturity" widget="date" attrs="{'required': [('display_type', '=', False)]}"/>
                                    </strong>
                                </div>
                                <div class="row mb4" style="min-height: 60px;">
                                    <em class="col-10">
                                        <field name="description" />
                                        <field name="doc_source" />
                                        <field name="product_id" />
                                    </em>
                                    <div class="col-2 text-end">
                                        <img
                                            t-att-src="kanban_image('res.partner', 'avatar_128', record.partner_id.raw_value)"
                                            t-att-title="record.partner_id.value"
                                            t-att-alt="record.partner_id.value"
                                            class="oe_kanban_avatar o_image_24_cover" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <field name="asset_profile_id" />
                                    </div>
                                    <div class="col-6 text-end">
                                        <t t-if="record.price_unit.raw_value > 0">
                                            <field name="price_unit" />
                                        </t>
                                    </div>
                                    <div class="col-6 text-end">
                                        <t t-if="record.price_total.raw_value > 0">
                                            <field name="price_total" />
                                        </t>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <field name='user_id' />
                                    </div>
                                    <div class="col-6">
                                        <field name='partner_id' />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-8">
                                        <h3 class='text-center'>Residual: <field
                                                name='amount_residual' class='alert alert-warning'
                                                widget='monetary' /></h3>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <!-- Search view -->
        <record id="account_suscription_order_line_view_search" model="ir.ui.view">
            <field name="name">account.suscription.order.line.search</field>
            <field name="model">account.suscription.order.line</field>
            <field name="arch" type="xml">
                <search string="Suscription Line Search">
                    <field name="ref" string="Reference"
                        filter_domain="[
                    '|', '|',
                        ('name', 'ilike', self),
                        ('ref', '=', self),
                        ('description', 'ilike', self)]" />
                    <separator />
                    <field name="product_id" string="Product" />
                    <field name="partner_id" string="Partner" />
                    <field name="credit_type" string="Credit Type" />
                    <field name='doc_source' string='Origin Doc' />
                    <separator />
                    <filter string="Line Type" name="line_type" context="{'group_by':'line_type'}" />
                    <filter string="Company" name="company_id" context="{'group_by':'company_id'}" />
                    <filter string="Money Type" name="money_type"
                        context="{'group_by':'money_type'}" />
                    <filter string="State" name="state" context="{'group_by':'state'}" />
                    <filter string="Credit Type" name="credit_type"
                        context="{'group_by':'credit_type'}" />
                    <filter string="Asset" name="asset_profile_id"
                        context="{'group_by':'asset_profile_id'}" />
                    <group expand="1" string="Group By">
                        <filter string="Order" name="order_id" context="{'group_by':'order_id'}" />
                        <filter string="User" name="user_id" context="{'group_by':'user_id'}" />
                        <filter name="active"
                            string="Active - Archived" domain="[('active','=',True)]" />
                    </group>
                    <!-- Panel lateral de busqueda -->
                    <searchpanel>
                        <field name='user_id' icon='fa fa-users' />
                        <field name='partner_id' icon='fa fa-list' select="multi"
                            groupby='position' />
                        <field name='currency_id' icon='fa fa-solid fa-wallet' select="multi"
                            groupby='position' />
                        <field name='product_id' icon='fa-solid fa-mug-saucer' select="multi"
                            groupby='position' />
                        <field name='asset_profile_id' icon='fa-solid fa-magnifying-glass-chart'
                            select="multi"
                            groupby='position' />
                    </searchpanel>
                </search>
            </field>
        </record>
        <!-- Accion para crear la emisíon -->
        <record id="account_suscription_order_line_action" model="ir.actions.act_window">
            <field name="name">Suscription Line</field>
            <field name="res_model">account.suscription.order.line</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="account_suscription_order_line_view_tree" />
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>
    </data>
</odoo>